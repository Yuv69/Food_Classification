<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - NutriVision</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 50%, #10b981 100%);
        }
        .dark-gradient {
            background: linear-gradient(135deg, #1f2937 0%, #111827 50%, #0f172a 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark-glass {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nutrition-card {
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nutrition-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
            background: rgba(0, 0, 0, 0.5);
        }
        .confidence-bar {
            transition: width 0.5s ease;
        }
        .macro-circle {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .macro-circle svg {
            transform: rotate(-90deg);
        }
        .macro-circle .percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 14px;
        }
        .nav-glass {
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.5); }
        }
        .glow-animation {
            animation: glow 2s ease-in-out infinite;
        }
        .macro-protein {
            filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.5));
        }
        .macro-carbs {
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
        }
        .macro-fat {
            filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.5));
        }
        .vitamin-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .info-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .allergen-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        .health-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .dietary-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        .origin-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .staggered-1 { animation-delay: 0.1s; }
        .staggered-2 { animation-delay: 0.2s; }
        .staggered-3 { animation-delay: 0.3s; }
        .staggered-4 { animation-delay: 0.4s; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <nav class="nav-glass">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-leaf text-3xl text-emerald-400 mr-3 glow-animation"></i>
                    <span class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">NutriVision</span>
                </div>
                <div class="flex space-x-6">
                    <a href="/" class="text-gray-300 hover:text-emerald-400 transition">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                    <a href="/compare" class="text-gray-300 hover:text-purple-400 transition">
                        <i class="fas fa-balance-scale mr-2"></i>Compare
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <section class="gradient-bg py-16 relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-20"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4 text-white drop-shadow-2xl">Analysis Complete!</h1>
                <p class="text-xl opacity-90 text-gray-100">Here's everything we discovered about your food</p>
            </div>
        </div>
    </section>

    <section class="py-12">
        <div class="container mx-auto px-6">
            <div class="max-w-7xl mx-auto">
                <div class="grid xl:grid-cols-3 lg:grid-cols-2 gap-8">
                    <!-- Image Analysis Card -->
                    <div class="dark-glass rounded-xl shadow-2xl overflow-hidden fade-in-up">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold mb-4 text-white">
                                <i class="fas fa-image mr-2 text-purple-400"></i>Image Analysis
                            </h2>
                            <div class="mb-4">
                                <img src="{{ url_for('static', filename=result.image_path) }}" 
                                     alt="Analyzed food" 
                                     class="w-full h-48 object-cover rounded-lg shadow-2xl border border-gray-700">
                            </div>
                            
                            <div class="bg-purple-900 bg-opacity-30 rounded-lg p-6 border border-purple-500 border-opacity-20 mb-4">
                                <div class="text-center mb-4">
                                    <h3 class="text-3xl font-bold text-purple-400 mb-2">{{ result.food.title() }}</h3>
                                    <p class="text-gray-300">Detected Food Item</p>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-300">AI Confidence</span>
                                        <span class="text-sm font-medium text-purple-400">{{ "%.1f"|format(result.confidence * 100) }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div class="confidence-bar bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" data-width="{{ result.confidence * 100 }}"></div>
                                    </div>
                                </div>
                            </div>

                            {% if nutrition %}
                            <!-- Origin & Preparation Info -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="origin-card p-3 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-globe text-amber-400"></i>
                                        <div>
                                            <p class="text-xs text-gray-400">Origin</p>
                                            <p class="text-sm font-semibold text-amber-400">{{ nutrition.origin }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="origin-card p-3 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-clock text-amber-400"></i>
                                        <div>
                                            <p class="text-xs text-gray-400">Prep Time</p>
                                            <p class="text-sm font-semibold text-amber-400">{{ nutrition.preparation_time }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <div class="flex space-x-3">
                                <a href="/" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-center py-2 px-4 rounded-lg hover:from-purple-700 hover:to-pink-700 transition shadow-lg">
                                    <i class="fas fa-camera mr-2"></i>Analyze Another
                                </a>
                                <a href="/compare" class="flex-1 bg-gradient-to-r from-emerald-600 to-cyan-600 text-white text-center py-2 px-4 rounded-lg hover:from-emerald-700 hover:to-cyan-700 transition shadow-lg">
                                    <i class="fas fa-balance-scale mr-2"></i>Compare Foods
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Nutritional Facts Card -->
                    <div class="dark-glass rounded-xl shadow-2xl fade-in-up staggered-1">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-white">
                                    <i class="fas fa-chart-pie mr-2 text-emerald-400"></i>Nutritional Facts
                                </h2>
                                <div class="flex items-center space-x-2">
                                    <label class="text-sm font-medium text-gray-300">Serving Size:</label>
                                    <select id="servingSize" class="border border-gray-600 bg-gray-800 text-white rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="50">50g</option>
                                        <option value="100" selected>100g</option>
                                        <option value="150">150g</option>
                                        <option value="200">200g</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>

                            <div id="customWeightDiv" class="hidden mb-4">
                                <label class="block text-sm font-medium text-gray-300 mb-1">Custom Weight (grams):</label>
                                <input type="number" id="customWeight" min="1" max="1000" value="100" 
                                       class="border border-gray-600 bg-gray-800 text-white rounded-md px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>

                            <div id="nutritionContent">
                                {% if nutrition %}
                                <div class="grid grid-cols-3 gap-4 mb-8">
                                    <div class="text-center">
                                        <div class="macro-circle mx-auto mb-2 macro-protein">
                                            <svg width="120" height="120">
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(75, 85, 99, 0.3)" stroke-width="8"/>
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="#ef4444" stroke-width="8" 
                                                        stroke-dasharray="314" 
                                                        data-dashoffset="{{ 314 - (nutrition.protein * 314 / (nutrition.protein + nutrition.carbs + nutrition.fat)) }}"
                                                        class="transition-all duration-1000 protein-circle"/>
                                            </svg>
                                            <div class="percentage text-red-400" data-base="{{ nutrition.protein if nutrition else 0 }}">{{ "%.0f"|format(nutrition.protein) }}g</div>
                                        </div>
                                        <p class="text-sm font-medium text-gray-300">Protein</p>
                                    </div>
                                    
                                    <div class="text-center">
                                        <div class="macro-circle mx-auto mb-2 macro-carbs">
                                            <svg width="120" height="120">
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(75, 85, 99, 0.3)" stroke-width="8"/>
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="#3b82f6" stroke-width="8" 
                                                        stroke-dasharray="314" 
                                                        data-dashoffset="{{ 314 - (nutrition.carbs * 314 / (nutrition.protein + nutrition.carbs + nutrition.fat)) }}"
                                                        class="transition-all duration-1000 carbs-circle"/>
                                            </svg>
                                            <div class="percentage text-blue-400" data-base="{{ nutrition.carbs if nutrition else 0 }}">{{ "%.0f"|format(nutrition.carbs) }}g</div>
                                        </div>
                                        <p class="text-sm font-medium text-gray-300">Carbs</p>
                                    </div>
                                    
                                    <div class="text-center">
                                        <div class="macro-circle mx-auto mb-2 macro-fat">
                                            <svg width="120" height="120">
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(75, 85, 99, 0.3)" stroke-width="8"/>
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="#f59e0b" stroke-width="8" 
                                                        stroke-dasharray="314" 
                                                        data-dashoffset="{{ 314 - (nutrition.fat * 314 / (nutrition.protein + nutrition.carbs + nutrition.fat)) }}"
                                                        class="transition-all duration-1000 fat-circle"/>
                                            </svg>
                                            <div class="percentage text-yellow-400" data-base="{{ nutrition.fat if nutrition else 0 }}">{{ "%.0f"|format(nutrition.fat) }}g</div>
                                        </div>
                                        <p class="text-sm font-medium text-gray-300">Fat</p>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <div class="nutrition-card bg-gradient-to-r from-purple-900 to-pink-900 bg-opacity-30 p-4 rounded-lg border border-purple-500 border-opacity-20">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center">
                                                <i class="fas fa-fire text-orange-400 text-xl mr-3 glow-animation"></i>
                                                <span class="font-semibold text-white">Calories</span>
                                            </div>
                                            <span class="text-2xl font-bold text-purple-400" id="caloriesValue" data-base="{{ nutrition.calories if nutrition else 0 }}">{{ "%.0f"|format(nutrition.calories) }}</span>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="nutrition-card p-3 rounded-lg">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-300">Fiber</span>
                                                <span class="text-sm font-bold text-emerald-400" id="fiberValue" data-base="{{ nutrition.fiber if nutrition else 0 }}">{{ "%.1f"|format(nutrition.fiber) }}g</span>
                                            </div>
                                        </div>
                                        <div class="nutrition-card p-3 rounded-lg">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-300">Sugar</span>
                                                <span class="text-sm font-bold text-pink-400" id="sugarValue" data-base="{{ nutrition.sugar if nutrition else 0 }}">{{ "%.1f"|format(nutrition.sugar) }}g</span>
                                            </div>
                                        </div>
                                        <div class="nutrition-card p-3 rounded-lg col-span-2">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-300">Sodium</span>
                                                <span class="text-sm font-bold text-yellow-400" id="sodiumValue" data-base="{{ nutrition.sodium if nutrition else 0 }}">{{ "%.0f"|format(nutrition.sodium) }}mg</span>
                                            </div>
                                        </div>
                                    </div>

                                    {% if nutrition.vitamins %}
                                    <div class="mt-6">
                                        <h3 class="text-lg font-semibold mb-3 text-white">
                                            <i class="fas fa-pills mr-2 text-emerald-400 glow-animation"></i>Vitamins & Minerals
                                        </h3>
                                        <div class="grid grid-cols-2 gap-3">
                                            {% for vitamin, value in nutrition.vitamins.items() %}
                                            <div class="vitamin-card p-3 rounded-lg">
                                                <div class="flex justify-between">
                                                    <span class="text-sm font-medium text-gray-300 capitalize">{{ vitamin.replace('_', ' ') }}</span>
                                                    <span class="text-sm font-bold text-emerald-400">{{ value }}</span>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% else %}
                                <div class="text-center py-8">
                                    <i class="fas fa-exclamation-triangle text-4xl text-yellow-400 mb-4"></i>
                                    <h3 class="text-xl font-semibold text-gray-300 mb-2">Nutritional Data Unavailable</h3>
                                    <p class="text-gray-400">Sorry, we don't have nutritional information for this food item yet.</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Details Card -->
                    {% if nutrition %}
                    <div class="dark-glass rounded-xl shadow-2xl fade-in-up staggered-2">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold mb-6 text-white">
                                <i class="fas fa-info-circle mr-2 text-blue-400"></i>Food Details
                            </h2>
                            
                            <!-- Description -->
                            <div class="info-card p-4 rounded-lg mb-6">
                                <h3 class="text-lg font-semibold mb-2 text-blue-400">
                                    <i class="fas fa-book-open mr-2"></i>About {{ nutrition.name }}
                                </h3>
                                <p class="text-gray-300 text-sm leading-relaxed">{{ nutrition.description }}</p>
                            </div>

                            <!-- Detailed Description -->
                            <div class="info-card p-4 rounded-lg mb-6">
                                <h3 class="text-lg font-semibold mb-2 text-blue-400">
                                    <i class="fas fa-scroll mr-2"></i>Cultural Background
                                </h3>
                                <p class="text-gray-300 text-sm leading-relaxed">{{ nutrition.detailed_description }}</p>
                            </div>

                            <!-- Allergens -->
                            {% if nutrition.allergens %}
                            <div class="allergen-card p-4 rounded-lg mb-4">
                                <h3 class="text-lg font-semibold mb-3 text-red-400">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Allergen Information
                                </h3>
                                <div class="grid grid-cols-1 gap-2">
                                    {% for allergen in nutrition.allergens %}
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-shield-virus text-red-400 text-sm"></i>
                                        <span class="text-sm text-gray-300">{{ allergen }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Dietary Info -->
                            {% if nutrition.dietary_info %}
                            <div class="dietary-card p-4 rounded-lg mb-4">
                                <h3 class="text-lg font-semibold mb-3 text-purple-400">
                                    <i class="fas fa-utensils mr-2"></i>Dietary Information
                                </h3>
                                <div class="flex flex-wrap gap-2">
                                    {% for info in nutrition.dietary_info %}
                                    <span class="bg-purple-900 bg-opacity-40 px-3 py-1 rounded-full text-sm text-purple-300 border border-purple-500 border-opacity-30">
                                        {{ info }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Health Benefits -->
                            {% if nutrition.health_benefits %}
                            <div class="health-card p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-3 text-emerald-400">
                                    <i class="fas fa-heart mr-2"></i>Health Benefits
                                </h3>
                                <div class="space-y-2">
                                    {% for benefit in nutrition.health_benefits %}
                                    <div class="flex items-start space-x-2">
                                        <i class="fas fa-check-circle text-emerald-400 text-sm mt-1"></i>
                                        <span class="text-sm text-gray-300">{{ benefit }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-800 border-t border-gray-700 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-leaf text-3xl text-emerald-400 mr-3 glow-animation"></i>
                <span class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">NutriVision</span>
            </div>
            <p class="text-gray-400 mb-4">AI-Powered Food Recognition & Nutrition Analysis</p>
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" class="text-gray-400 hover:text-emerald-400 transition">
                    <i class="fab fa-github text-xl"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-purple-400 transition">
                    <i class="fab fa-twitter text-xl"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-pink-400 transition">
                    <i class="fab fa-instagram text-xl"></i>
                </a>
            </div>
            <p class="text-sm text-gray-500">&copy; 2024 NutriVision. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set the width of the confidence bar
            const confidenceBar = document.querySelector('.confidence-bar');
            if (confidenceBar) {
                const widthValue = confidenceBar.dataset.width;
                confidenceBar.style.width = widthValue + '%';
            }

            // Get the calculated values from the data attributes
            const proteinCircle = document.querySelector('.protein-circle');
            const carbsCircle = document.querySelector('.carbs-circle');
            const fatCircle = document.querySelector('.fat-circle');

            // Apply the dash offsets if the elements exist
            if (proteinCircle) {
                proteinCircle.style.strokeDashoffset = proteinCircle.dataset.dashoffset;
            }
            if (carbsCircle) {
                carbsCircle.style.strokeDashoffset = carbsCircle.dataset.dashoffset;
            }
            if (fatCircle) {
                fatCircle.style.strokeDashoffset = fatCircle.dataset.dashoffset;
            }

            // Serving size functionality
            const servingSizeSelect = document.getElementById('servingSize');
            const customWeightDiv = document.getElementById('customWeightDiv');
            const customWeightInput = document.getElementById('customWeight');

            if (servingSizeSelect) {
                servingSizeSelect.addEventListener('change', function() {
                    if (this.value === 'custom') {
                        customWeightDiv.classList.remove('hidden');
                    } else {
                        customWeightDiv.classList.add('hidden');
                        updateNutritionValues(parseInt(this.value));
                    }
                });
            }

            if (customWeightInput) {
                customWeightInput.addEventListener('input', function() {
                    updateNutritionValues(parseInt(this.value) || 100);
                });
            }

            function updateNutritionValues(grams) {
                const multiplier = grams / 100;

                // Update all nutrition values based on the multiplier
                const elements = [
                    { id: 'caloriesValue', suffix: '', round: true },
                    { id: 'fiberValue', suffix: 'g', round: false },
                    { id: 'sugarValue', suffix: 'g', round: false },
                    { id: 'sodiumValue', suffix: 'mg', round: true }
                ];

                elements.forEach(({ id, suffix, round }) => {
                    const element = document.getElementById(id);
                    if (element) {
                        const baseValue = parseFloat(element.dataset.base);
                        let newValue = baseValue * multiplier;
                        if (round) {
                            newValue = Math.round(newValue);
                        } else {
                            newValue = newValue.toFixed(1);
                        }
                        element.textContent = newValue + suffix;
                    }
                });

                // Update macro circle values
                const proteinElement = document.querySelector('.macro-protein .percentage');
                const carbsElement = document.querySelector('.macro-carbs .percentage');
                const fatElement = document.querySelector('.macro-fat .percentage');

                if (proteinElement) {
                    const protein = parseFloat(proteinElement.dataset.base) * multiplier;
                    proteinElement.textContent = Math.round(protein) + 'g';
                }
                if (carbsElement) {
                    const carbs = parseFloat(carbsElement.dataset.base) * multiplier;
                    carbsElement.textContent = Math.round(carbs) + 'g';
                }
                if (fatElement) {
                    const fat = parseFloat(fatElement.dataset.base) * multiplier;
                    fatElement.textContent = Math.round(fat) + 'g';
                }
            }

            // Staggered animations
            const cards = document.querySelectorAll('.fade-in-up');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                setTimeout(() => {
                    card.style.opacity = '1';
                }, index * 150);
            });
        });
    </script>
</body>
</html>